<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PhonePe Native • r.international@ptyes</title>
  <style>
    :root { --bg:#0f1220; --card:#171b2d; --text:#e8ecff; --muted:#9aa3c7; --accent:#6ea8ff; --line:#283052 }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
    .wrap{max-width:720px;margin:0 auto;padding:28px}
    h1{margin:0 0 6px;font-size:22px}
    p{margin:0 0 14px;color:var(--muted)}
    .card{background:#151a31;border:1px solid var(--line);border-radius:16px;padding:18px;margin-top:14px}
    .who{display:flex;justify-content:space-between;align-items:center}
    .tag{font-size:12px;border:1px solid var(--line);padding:2px 8px;border-radius:999px;color:#c7cff4}
    .vpa{font-family:ui-monospace,Menlo,Consolas,monospace;color:#cfd6ff;margin-top:8px}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    button{appearance:none;border:1px solid var(--line);background:#1c2240;color:#e8ecff;padding:10px 12px;border-radius:12px;cursor:pointer}
    button.primary{background:var(--accent);color:#0f1220;border-color:transparent;font-weight:600}
    code{word-break:break-all}
    .hint{margin-top:10px;font-size:13px;color:#b6bfdf}
    .ok{color:#7dffa3}.err{color:#ff9b9b}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>PhonePe Native • r.international@ptyes</h1>
    <p>Открой эту страницу в <b>Chrome на Android</b>. Телеграм-вебвью может не передавать диплинки. Сумма фиксирована: ₹10, заметка: 0x1B.</p>
    <div id="status" class="hint">Готово.</div>

    <div class="card">
      <div class="who">
        <strong>Ms Regent International</strong>
        <span class="tag">₹10 • note: 0x1B</span>
      </div>
      <div class="vpa">VPA: <code>r.international@ptyes</code></div>

      <p style="margin-top:12px">Ссылка:</p>
      <code id="deeplink">строится…</code>

      <div class="row">
        <button class="primary" id="open">Открыть в PhonePe</button>
        <button id="copy">Скопировать</button>
      </div>
    </div>

    <div class="hint">Если появится «Could not initiate transaction» — для некоторых VPA типа <code>@ptyes</code> PhonePe может требовать мерчант-подпись; в этом случае используйте Paytm/GPay маршрут.</div>
  </div>

  <script>
    // параметры
    const vpa   = "r.international@ptyes";
    const note  = "0x1B";
    const rupees = 10.00;                // ₹10.00
    const paise  = Math.round(rupees*100);

    // base64url без паддинга
    function b64url(str){
      const b64 = btoa(unescape(encodeURIComponent(str)))
        .replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
      return encodeURIComponent(b64);
    }

    // payload, как у PhonePe native
    const payload = {
      contact: { cbsName:"", nickName:"", vpa, type:"VPA" },
      p2pPaymentCheckoutParams: {
        note,
        isByDefaultKnownContact: true,
        enableSpeechToText: false,
        allowAmountEdit: false,
        showQrCodeOption: false,
        disableViewHistory: true,
        shouldShowUnsavedContactBanner: false,
        isRecurring: false,
        checkoutType: "DEFAULT",
        transactionContext: "p2p",
        initialAmount: paise,          // в пайсах
        disableNotesEdit: true,
        showKeyboard: true,
        currency: "INR",
        shouldShowMaskedNumber: true
      }
    };

    const data = b64url(JSON.stringify(payload));
    const link = `phonepe://native?data=${data}&id=p2ppayment`;

    // UI
    const status = document.getElementById('status');
    const codeEl = document.getElementById('deeplink');
    const openBtn = document.getElementById('open');
    const copyBtn = document.getElementById('copy');

    codeEl.textContent = link;

    function setStatus(msg, ok=false){
      status.textContent = msg;
      status.className = 'hint ' + (ok ? 'ok' : '');
    }

    openBtn.addEventListener('click', () => {
      if (!/Android/i.test(navigator.userAgent)) setStatus('Открой на Android с установленным PhonePe.');
      window.location.href = link;
      setStatus('Пробую открыть PhonePe…');
    });

    copyBtn.addEventListener('click', async () => {
      try { await navigator.clipboard.writeText(link); setStatus('Ссылка скопирована.', true); }
      catch { setStatus('Не удалось скопировать. Скопируй вручную.'); }
    });
  </script>
</body>
</html>
